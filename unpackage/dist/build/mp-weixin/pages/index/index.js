"use strict";const e=require("../../common/vendor.js"),i=require("../../common/assets.js"),n={data:()=>({title:"Hello",tmplIds:["WhDz7V9NVqZi6Fo3K0-CB7TJuOlU21LhOlo9YaoXsc8"],token:"",tokenExpired:"",uid:"",loggingIn:!1}),onLoad(){},methods:{async weixinLogin(){if(!this.loggingIn){this.loggingIn=!0;try{const i=await new Promise(((i,n)=>{e.index.login({provider:"weixin",success:i,fail:n})})),n=e.tr.importObject("uni-id-co"),o=await n.loginByWeixin({code:i.code});if(o.errCode)throw new Error(o.errMsg||"登录失败");const{token:t,tokenExpired:r}=o.newToken||{};this.token=t,this.tokenExpired=r,this.uid=o.uid,e.index.setStorageSync("uni_id_token",t),e.index.setStorageSync("uni_id_token_expired",r),e.index.showToast({title:"登录成功",icon:"success"})}catch(i){console.error("weixinLogin error",i),e.index.showToast({title:i.message||"微信登录失败",icon:"none"})}finally{this.loggingIn=!1}}}}};const o=e._export_sfc(n,[["render",function(n,o,t,r,s,c){return e.e({a:i._imports_0,b:e.t(s.title),c:e.o(((...e)=>n.requestSubscribe&&n.requestSubscribe(...e))),d:s.loggingIn,e:e.o(((...e)=>c.weixinLogin&&c.weixinLogin(...e))),f:s.token},s.token?{g:e.t(s.uid),h:e.t(s.token),i:e.t(s.tokenExpired)}:{})}]]);wx.createPage(o);
