"use strict";const e=require("../../common/vendor.js"),i=require("../../common/assets.js"),o={data:()=>({title:"Hello",tmplIds:["WhDz7V9NVqZi6Fo3K0-CB7TJuOlU21LhOlo9YaoXsc8"],token:"",tokenExpired:"",uid:"",loggingIn:!1}),onLoad(){},methods:{requestSubscribe(){this.tmplIds&&0!==this.tmplIds.length?e.index.requestSubscribeMessage({tmplIds:this.tmplIds,success:i=>{const o=Object.values(i).some((e=>"accept"===e));e.index.showToast({title:o?"订阅成功":"未订阅通知",icon:o?"success":"none"})},fail:i=>{console.error("requestSubscribeMessage fail",i),e.index.showToast({title:"订阅失败，请稍后重试",icon:"none"})}}):e.index.showToast({title:"请先配置模板 ID",icon:"none"})},async weixinLogin(){if(!this.loggingIn){this.loggingIn=!0;try{const i=await new Promise(((i,o)=>{e.index.login({provider:"weixin",success:i,fail:o})})),o=e.tr.importObject("uni-id-co"),t=await o.loginByWeixin({code:i.code});if(t.errCode)throw new Error(t.errMsg||"登录失败");const{token:n,tokenExpired:s}=t.newToken||{};this.token=n,this.tokenExpired=s,this.uid=t.uid,e.index.setStorageSync("uni_id_token",n),e.index.setStorageSync("uni_id_token_expired",s),e.index.showToast({title:"登录成功",icon:"success"})}catch(i){console.error("weixinLogin error",i),e.index.showToast({title:i.message||"微信登录失败",icon:"none"})}finally{this.loggingIn=!1}}}}};const t=e._export_sfc(o,[["render",function(o,t,n,s,r,c){return e.e({a:i._imports_0,b:e.t(r.title),c:e.o(((...e)=>c.requestSubscribe&&c.requestSubscribe(...e))),d:r.loggingIn,e:e.o(((...e)=>c.weixinLogin&&c.weixinLogin(...e))),f:r.token},r.token?{g:e.t(r.uid),h:e.t(r.token),i:e.t(r.tokenExpired)}:{})}]]);wx.createPage(t);
